<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Upload Page</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 2rem; }
    input, button { margin: 0.5rem 0; padding: 0.5rem; width: 100%; }
    #result { margin-top: 1rem; color: green; }
    #error { margin-top: 1rem; color: red; }
  </style>
</head>
<body>
  <h1>ตรวจสอบหมายเลขบัตรประชาชน</h1>

  <input type="text" id="nationalIdInput" placeholder="กรอกเลขบัตรประชาชน (13 หลัก)" maxlength="13">
  <button onclick="checkNationalId()">ตรวจสอบข้อมูล</button>

  <div id="result"></div>
  <div id="error"></div>

  <script>
    async function checkNationalId() {
      const nationalId = document.getElementById('nationalIdInput').value.trim();
      const resultDiv = document.getElementById('result');
      const errorDiv = document.getElementById('error');
      resultDiv.textContent = '';
      errorDiv.textContent = '';

      if (!nationalId || nationalId.length !== 13) {
        errorDiv.textContent = 'กรุณากรอกเลขบัตรประชาชนให้ถูกต้อง (13 หลัก)';
        return;
      }

      const nationalIdHash = await sha256(nationalId);
      const url = 'https://script.google.com/macros/s/AKfycbw98GJjQWedgzab9SLCBCtaGTT0SFM3J0KbIKIdCjyiYM4u1-TQWGS2ca0cmdDZdnwhaA/exec?action=checkNationalId&nationalIdHash=' + nationalIdHash;

      try {
        const response = await fetch(url);
        const data = await response.json();
        if (data.success) {
          resultDiv.textContent = `พบข้อมูล: ${data.name}`;
        } else {
          errorDiv.textContent = 'ไม่พบข้อมูลในระบบ';
        }
      } catch (error) {
        console.error('Fetch error:', error);
        errorDiv.textContent = 'เกิดข้อผิดพลาดในการเชื่อมต่อ';
      }
    }

    async function sha256(message) {
      const msgBuffer = new TextEncoder().encode(message);
      const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
      const hashArray = Array.from(new Uint8Array(hashBuffer));
      const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
      return hashHex;
    }
  </script>
</body>
</html>
